/*!
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
"use strict";(self["webpackChunk_glpi_glpi"]=self["webpackChunk_glpi_glpi"]||[]).push([[10],{27:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t){n[e]=a}return n}},70:(e,t,n)=>{n.r(t);n.d(t,{default:()=>i});var a=n(71);var s=n(73);var r=n(27);const o=(0,r["default"])(s["default"],[["render",a.render],["__file","js/src/vue/Debug/Widget/RequestTimeline.vue"]]);if(false){}const i=o},71:(e,t,n)=>{n.r(t);n.d(t,{render:()=>a.render});var a=n(72)},72:(e,t,n)=>{n.r(t);n.d(t,{render:()=>r});var a=n(9);const s=["height"];function r(e,t,n,r,o,i){return(0,a.openBlock)(),(0,a.createElementBlock)("canvas",{height:r.canvas_height,onMousemove:r.onCanvasMouseMove,onMouseleave:r.onCanvasMouseLeave,onClick:r.onCanvasClick},null,40,s)}},73:(e,t,n)=>{n.r(t);n.d(t,{default:()=>a["default"]});var a=n(74)},74:(e,t,n)=>{n.r(t);n.d(t,{default:()=>c});var a=n(9);const s=10;const r=150;const o=4;const i=2;const l=100;const c={__name:"RequestTimeline",props:{initial_request:{type:Object,required:true},ajax_requests:{type:Array,required:true},content_area:{type:Object,required:true}},emits:["change_request"],setup(e,{expose:t,emit:n}){t();const c=e;const u=n;const d={queued:"#808080",redirect:"#00aaaa",fetch:"#004400",dns:"#00cc88",connection:"#ffaa00",initial_connection:"#ffaa88",ssl:"#cc00cc",request:"#00aa00",response:"#0000ee"};const f=(0,a.computed)(()=>{const e=window.performance.getEntriesByType("navigation")[0];const t=window.performance.getEntriesByType("resource");const n=[];n.push({type:"navigation",name:e.name,start:e.startTime,end:e.responseEnd,bounds:{},sections:{queued:[e.startTime,e.redirectStart],redirect:[e.redirectStart,e.redirectEnd],fetch:[e.redirectEnd,e.redirectStart],dns:[e.domainLookupStart,e.domainLookupEnd],connection:[e.connectStart,e.connectEnd],initial_connection:[e.connectStart,e.secureConnectionStart],ssl:[e.secureConnectionStart,e.connectEnd],request:[e.requestStart,e.responseStart],response:[e.responseStart,e.responseEnd]}});$.each(t,(e,t)=>{n.push({type:t.initiatorType,name:t.name,start:t.startTime,end:t.responseEnd,bounds:{},sections:{queued:[t.startTime,t.redirectStart!==0?t.redirectStart:t.domainLookupStart],redirect:[t.redirectStart,t.redirectEnd],fetch:[t.redirectEnd,t.redirectStart],dns:[t.domainLookupStart,t.domainLookupEnd],connection:[t.connectStart,t.connectEnd],initial_connection:[t.connectStart,t.secureConnectionStart],ssl:[t.secureConnectionStart,t.connectEnd],request:[t.requestStart,t.responseStart],response:[t.responseStart,t.responseEnd]}})});let a=0;$.each(n,(e,t)=>{const n=t.sections.response[1];if(n>a){a=n}});return{end_ts:a,timings:n}});const v=f.value.end_ts;const h=f.value.timings;const p=window.performance.timeOrigin;const g=[];const _=(e,t,n)=>{let a=false;$.each(e,(e,s)=>{if(t>=s.start&&t<=s.end||n>=s.start&&n<=s.end){a=true;return false}});return a};$.each(h,(e,t)=>{let n=null;$.each(g,(e,a)=>{if(!_(a,t.start,t.end)){n=a;return false}});if(n===null){n=[t];g.push(n)}else{n.push(t)}});const m=(0,a.computed)(()=>g.length*(o+i)+12);const S=(0,a.ref)(null);const y=(0,a.ref)(null);const q=(0,a.computed)(()=>S.value.css("color"));(0,a.onMounted)(()=>{S.value=$(c.content_area).find("canvas").eq(0);y.value=S.value[0].getContext("2d");const e=window.setInterval(()=>{if(S.value.length===0){window.clearInterval(e);return}S.value.trigger("render")},1e3/s);S.value.on("render",x)});function M(e,t,n){const a=$(c.content_area).data("requests_request_id");let s=false;if(a===c.initial_request.id&&e.type==="navigation"){s=true}else{const r=c.ajax_requests.find(e=>e.id===a);if(r===undefined){return false}const o=[];$.each(n,(e,t)=>{if(t.name.endsWith(r.url)){o.push({i:e,entry:t})}});if(o.length===1&&o[0].i===t){s=true}else{let n=null;o.forEach((t,a)=>{if(n===null){n=a;return}const s=a.start-p;if(Math.abs(s-e.start)<Math.abs(n.start-e.start)){n=a}});s=n!==null&&n.i===t}}return s}const E=(0,a.ref)(null);function x(){S.value.attr("width",S.value.parent().width());const e=S.value.width();const t=S.value.height();const n=Math.ceil(v/100)*100;const a=Math.min(Math.ceil(e/r),Math.ceil(n/l));const s=[];for(let t=0;t<a;t++){s.push({canvas_x:Math.round(e/a*t),time:Math.ceil(n/a*t/100)*100})}y.value.fillStyle="#80808040";y.value.fillRect(0,0,e,t);$.each(s,(e,n)=>{y.value.fillStyle=q.value;y.value.strokeStyle=q.value;y.value.font=y.value.font.replace(/\d+px/,"10px");y.value.beginPath();y.value.moveTo(n.canvas_x,0);y.value.lineTo(n.canvas_x,t);y.value.stroke();y.value.fillText(`${n.time} ms`,n.canvas_x+2,10)});$.each(g,(t,n)=>{const a=t*(o+i)+12;$.each(n,(t,s)=>{const r=M(s,t,n);const i=s.sections;$.each(i,(t,n)=>{if(n[0]===0&&n[1]===0){return}const i=d[t]||"#00aa00";const l=Math.round((n[1]-n[0])/v*e);const c=Math.round(n[0]/v*e);s.bounds[t]={x:c,y:a,width:l,height:o};y.value.fillStyle=i;y.value.fillRect(c,a,l,o);if(r){const e=y.value.strokeStyle;y.value.strokeStyle="#ffff00";y.value.strokeRect(c,a,l,o);y.value.strokeRect(c-1,a-1,l+2,o+2);y.value.strokeStyle=e}})})});if(E.value!==null){y.value.fillStyle="#808080";const e=E.value.target.section;const t=e.sections[E.value.target.timing][1]-e.sections[E.value.target.timing][0];let n=e.name;if(n.length>100){n=n.slice(0,100)+"..."}const a=`${n} ${E.value.target.timing} (${t.toFixed(0)} ms)`;y.value.font=y.value.font.replace(/\d+px/,"14px");const s=y.value.measureText(a).width;y.value.fillRect(e.bounds[E.value.target.timing].x,e.bounds[E.value.target.timing].y+o,s+4,18);y.value.fillStyle=q.value;y.value.fillText(a,e.bounds[E.value.target.timing].x+2,e.bounds[E.value.target.timing].y+o+14)}}function b(e){const t=e.offsetX;const n=e.offsetY;let a=null;$.each(g,(e,s)=>{$.each(s,(e,s)=>{$.each(s.bounds,(e,r)=>{if(t>=r.x&&t<=r.x+r.width&&n>=r.y&&n<=r.y+r.height){a={section:s,timing:e};return false}});if(a!==null){return false}});if(a!==null){return false}});if(a!==null){E.value={target:a};S.value.css("cursor","pointer")}else{E.value=null;S.value.css("cursor","default")}}function k(){E.value=null;S.value.css("cursor","default")}function T(){if(E.value!==null){const e=E.value.target.section;let t=null;if(e.type==="navigation"){t=c.initial_request.id}else{const n=[];$.each(c.ajax_requests,(t,a)=>{if(e.name.endsWith(a.url)){n.push(a)}});if(n.length===1){t=n[0].id}else{let a=null;n.forEach((t,n)=>{if(a===null){a=n;return}const s=n.start-p;if(Math.abs(s-e.start)<Math.abs(a.start-e.start)){a=n}});if(a!==null){t=a.id}}}if(t!==null){$(c.content_area).data("requests_request_id",t);u("change_request");S.value.trigger("render")}}}const w={props:c,emit:u,TIMING_COLORS:d,request_timings:f,end_ts:v,timings:h,time_origin:p,sections:g,hasOverlap:_,TIMELINE_REFRESH_RATE:s,DIVIDER_WIDTH:r,ROW_HEIGHT:o,ROW_MARGIN:i,canvas_height:m,canvas_el:S,ctx:y,text_color:q,division_length:l,is_entry_selected:M,hover_data:E,onCanvasRender:x,onCanvasMouseMove:b,onCanvasMouseLeave:k,onCanvasClick:T,computed:a.computed,onMounted:a.onMounted,ref:a.ref};Object.defineProperty(w,"__isScriptSetup",{enumerable:false,value:true});return w}}}}]);