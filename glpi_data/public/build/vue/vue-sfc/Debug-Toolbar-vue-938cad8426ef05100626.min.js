/*!
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
"use strict";(self["webpackChunk_glpi_glpi"]=self["webpackChunk_glpi_glpi"]||[]).push([[3],{18:e=>{var t=[];function n(e){var n=-1;for(var a=0;a<t.length;a++){if(t[a].identifier===e){n=a;break}}return n}function a(e,a){var i={};var o=[];for(var s=0;s<e.length;s++){var d=e[s];var u=a.base?d[0]+a.base:d[0];var l=i[u]||0;var c="".concat(u," ").concat(l);i[u]=l+1;var g=n(c);var p={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(g!==-1){t[g].references++;t[g].updater(p)}else{var f=r(p,a);a.byIndex=s;t.splice(s,0,{identifier:c,updater:f,references:1})}o.push(c)}return o}function r(e,t){var n=t.domAPI(t);n.update(e);var a=function t(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap&&a.supports===e.supports&&a.layer===e.layer){return}n.update(e=a)}else{n.remove()}};return a}e.exports=function(e,r){r=r||{};e=e||[];var i=a(e,r);return function e(o){o=o||[];for(var s=0;s<i.length;s++){var d=i[s];var u=n(d);t[u].references--}var l=a(o,r);for(var c=0;c<i.length;c++){var g=i[c];var p=n(g);if(t[p].references===0){t[p].updater();t.splice(p,1)}}i=l}}},19:e=>{function t(e,t,n){var a="";if(n.supports){a+="@supports (".concat(n.supports,") {")}if(n.media){a+="@media ".concat(n.media," {")}var r=typeof n.layer!=="undefined";if(r){a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")}a+=n.css;if(r){a+="}"}if(n.media){a+="}"}if(n.supports){a+="}"}var i=n.sourceMap;if(i&&typeof btoa!=="undefined"){a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")}t.styleTagTransform(a,e,t.options)}function n(e){if(e.parentNode===null){return false}e.parentNode.removeChild(e)}function a(e){if(typeof document==="undefined"){return{update:function e(){},remove:function e(){}}}var a=e.insertStyleElement(e);return{update:function n(r){t(a,e,r)},remove:function e(){n(a)}}}e.exports=a},20:e=>{var t={};function n(e){if(typeof t[e]==="undefined"){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement){try{n=n.contentDocument.head}catch(e){n=null}}t[e]=n}return t[e]}function a(e,t){var a=n(e);if(!a){throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.")}a.appendChild(t)}e.exports=a},21:(e,t,n)=>{function a(e){var t=true?n.nc:0;if(t){e.setAttribute("nonce",t)}}e.exports=a},22:e=>{function t(e){var t=document.createElement("style");e.setAttributes(t,e.attributes);e.insert(t,e.options);return t}e.exports=t},23:e=>{function t(e,t){if(t.styleSheet){t.styleSheet.cssText=e}else{while(t.firstChild){t.removeChild(t.firstChild)}t.appendChild(document.createTextNode(e))}}e.exports=t},25:e=>{e.exports=function(e){var t=e[1];var n=e[3];if(!n){return t}if(typeof btoa==="function"){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n))));var r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a);var i="/*# ".concat(r," */");return[t].concat([i]).join("\n")}return[t].join("\n")}},26:e=>{e.exports=function(e){var t=[];t.toString=function t(){return this.map(function(t){var n="";var a=typeof t[5]!=="undefined";if(t[4]){n+="@supports (".concat(t[4],") {")}if(t[2]){n+="@media ".concat(t[2]," {")}if(a){n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")}n+=e(t);if(a){n+="}"}if(t[2]){n+="}"}if(t[4]){n+="}"}return n}).join("")};t.i=function e(n,a,r,i,o){if(typeof n==="string"){n=[[null,n,undefined]]}var s={};if(r){for(var d=0;d<this.length;d++){var u=this[d][0];if(u!=null){s[u]=true}}}for(var l=0;l<n.length;l++){var c=[].concat(n[l]);if(r&&s[c[0]]){continue}if(typeof o!=="undefined"){if(typeof c[5]==="undefined"){c[5]=o}else{c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}");c[5]=o}}if(a){if(!c[2]){c[2]=a}else{c[1]="@media ".concat(c[2]," {").concat(c[1],"}");c[2]=a}}if(i){if(!c[4]){c[4]="".concat(i)}else{c[1]="@supports (".concat(c[4],") {").concat(c[1],"}");c[4]=i}}t.push(c)}};return t}},27:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t){n[e]=a}return n}},44:(e,t,n)=>{n.r(t);n.d(t,{default:()=>d});var a=n(45);var r=n(47);var i=n(49);var o=n(27);const s=(0,o["default"])(r["default"],[["render",a.render],["__scopeId","data-v-67e46a13"],["__file","js/src/vue/Debug/Toolbar.vue"]]);if(false){}const d=s},45:(e,t,n)=>{n.r(t);n.d(t,{render:()=>a.render});var a=n(46)},46:(e,t,n)=>{n.r(t);n.d(t,{render:()=>c});var a=n(9);const r={class:"d-flex flex-row align-items-center"};const i={class:"debug-toolbar-badge d-flex"};const o=["disabled"];const s={class:"debug-toolbar-widgets nav nav-tabs align-items-center border-0","data-bs-toggle":"tabs"};const d={class:"debug-toolbar-controls"};const u={class:"debug-toolbar-control"};const l={id:"debug-toolbar-expanded-content",class:"w-100 card pe-2"};function c(e,t,n,c,g,p){const f=(0,a.resolveComponent)("widget-button");return(0,a.openBlock)(),(0,a.createElementBlock)("div",{id:"debug-toolbar",class:(0,a.normalizeClass)("position-fixed bottom-0 card "+(c.show_toolbar?"w-100":"")),tabindex:"0",style:(0,a.normalizeStyle)(c.show_toolbar?"":"width: fit-content")},[(0,a.createElementVNode)("div",{class:"resize-handle mt-n2",onMousedown:t[0]||(t[0]=(0,a.withModifiers)(e=>e.buttons===1&&(c.is_dragging=true),["prevent"]))},null,32),(0,a.createElementVNode)("div",r,[(0,a.createElementVNode)("div",i,[(0,a.createElementVNode)("button",{type:"button",class:"btn btn-icon border-0 px-3 opacity-100 debug-logo",onClick:t[1]||(t[1]=e=>c.show_toolbar=true),disabled:c.show_toolbar,title:"Toggle debug bar"},[...t[4]||(t[4]=[(0,a.createElementVNode)("i",{class:"ti ti-bug"},null,-1)])],8,o)]),(0,a.withDirectives)((0,a.createElementVNode)("div",{class:(0,a.normalizeClass)("debug-toolbar-content w-100 justify-content-between align-items-center "+(c.show_toolbar?"d-flex":""))},[(0,a.createElementVNode)("ul",s,[((0,a.openBlock)(true),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(c.getMainWidgets(),e=>((0,a.openBlock)(),(0,a.createBlock)(f,{id:e.id,title:e.title,icon:e.icon,onClick:t=>c.switchWidget(e.id),active:e.id===c.active_widget,onVnodeMounted:c.refreshWidgetButtons},null,8,["id","title","icon","onClick","active"]))),256))]),(0,a.createElementVNode)("div",d,[(0,a.createElementVNode)("div",u,[(0,a.createElementVNode)("button",{type:"button",class:"btn btn-icon border-0 p-1",name:"toggle_content_area",onClick:t[2]||(t[2]=e=>c.show_content_area=!c.show_content_area),title:"Toggle debug content area"},[(0,a.createElementVNode)("i",{class:(0,a.normalizeClass)(c.show_content_area?"ti ti-square-arrow-up":"ti ti-square-arrow-down")},null,2)]),(0,a.createElementVNode)("button",{type:"button",class:"btn btn-icon border-0 p-1",title:"Close",onClick:t[3]||(t[3]=e=>c.show_toolbar=false)},[...t[5]||(t[5]=[(0,a.createElementVNode)("i",{class:"ti ti-square-x"},null,-1)])])])])],2),[[a.vShow,c.show_toolbar]])]),(0,a.withDirectives)((0,a.createElementVNode)("div",l,[c.active_widget?((0,a.openBlock)(),(0,a.createBlock)((0,a.resolveDynamicComponent)(c.active_widget_component),{key:0,initial_request:c.props.initial_request,ajax_requests:c.ajax_requests,onSwitchWidget:c.switchWidget,widgets:c.widgets,onRefreshButton:c.refreshWidgetButtons},null,40,["initial_request","ajax_requests"])):(0,a.createCommentVNode)("v-if",true)],512),[[a.vShow,c.show_content_area&&c.show_toolbar]])],6)}},47:(e,t,n)=>{n.r(t);n.d(t,{default:()=>a["default"]});var a=n(48)},48:(e,t,n)=>{n.r(t);n.d(t,{default:()=>r});var a=n(9);const r={__name:"Toolbar",props:{initial_request:{type:Object,default:null}},setup(e,{expose:t}){t();const n=e;const r=(0,a.ref)(null);const i=(0,a.computed)(()=>{if(r.value===null){return null}const e=l.find(e=>e.id===r.value);if(e===undefined){return null}return e.component_registered_name});const o=(0,a.ref)([]);const s=(0,a.ref)(n.initial_request.id);const d=(0,a.computed)(()=>{if(s.value===null){return undefined}return v(s.value)});const u=(0,a.ref)(true);const l=[{id:"server_performance",title:"Server performance",icon:"ti ti-clock-play",main_widget:true,component_registered_name:"widget-server-performance",refreshButton:e=>{const t=n.initial_request.server_performance;const a=+(t.memory_usage/1024/1024).toFixed(2);const r=`${_.escape(t.execution_time)} <span class="text-muted"> ms using </span> ${_.escape(a)} <span class="text-muted"> MiB </span>`;e.find(".debug-text").html(r)}},{id:"sql",title:"SQL Requests",icon:"ti ti-database",main_widget:true,component_registered_name:"widget-sqlrequests",refreshButton:e=>{const t=p();const n=`${_.escape(t.total_requests)} <span class="text-muted"> requests </span>`;e.find(".debug-text").html(n)}},{id:"requests",title:"HTTP Requests",icon:"ti ti-refresh",main_widget:true,component_registered_name:"widget-httprequests",refreshButton:e=>{e.find(".debug-text").html(`${o.value.length+1} <span class="text-muted"> requests </span>`)}},{id:"client_performance",title:"Client performance",icon:"ti ti-brand-javascript",main_widget:true,component_registered_name:"widget-client-performance",refreshButton:e=>{if(e.find(".debug-text").text().trim()===""){setTimeout(()=>{const t=+window.performance.getEntriesByType("navigation")[0].domComplete.toFixed(2);const n=`${_.escape(t)} <span class="text-muted"> ms </span>`;e.find(".debug-text").html(n)},200)}}},{id:"search_options",title:"Search Options",icon:"ti ti-list-search",main_widget:true,component_registered_name:"widget-search-options",refreshButton:e=>{}},{id:"theme_switcher",title:"Palette Switcher",icon:"ti ti-palette",main_widget:true,component_registered_name:"widget-theme-switcher",refreshButton:e=>{e.find(".debug-text").html(`<span class="text-muted">Theme: </span> ${_.escape(document.documentElement.attributes["data-glpi-theme"].value)}`)}},{id:"globals",main_widget:false,component_registered_name:"widget-globals"},{id:"profiler",main_widget:false,component_registered_name:"widget-profiler"},{id:"request_summary",main_widget:false,component_registered_name:"widget-request-summary"}];$(document).ajaxSend((e,t,n)=>{if(n.url.indexOf("ajax/debug.php")!==-1){return}const a=Math.random().toString(16).slice(2);t.setRequestHeader("X-Glpi-Ajax-ID",a);t.headers=t.headers||{};t.headers["X-Glpi-Ajax-ID"]=a;const r=$("html").attr("data-glpi-request-id");if(r!==undefined){t.setRequestHeader("X-Glpi-Ajax-Parent-ID",r)}let i=n.data;if(n.type!=="POST"&&i===undefined){i={};const e=n.url.split("?")[1];if(e!==undefined){e.split("&").forEach(e=>{const[t,n]=e.split("=");i[t]=n})}}else if(typeof i==="string"){const e={};i.split("&").forEach(t=>{const[n,a]=t.split("=");e[n]=decodeURIComponent(a);try{e[n]=JSON.parse(e[n])}catch(e){}});i=e}o.value.push({id:a,status:"...",status_type:"info",type:n.type,data:i,url:n.url,start:e.timeStamp});h()});$(document).ajaxComplete((e,t,n)=>{if(n.url.indexOf("ajax/debug.php")!==-1){return}if(t.headers===undefined){return}const a=t.headers["X-Glpi-Ajax-ID"];if(a!==undefined){const e=o.value.find(e=>e.id===a);if(e!==undefined){e.status=t.status;e.time=new Date-e.start;e.status_type=t.status>=200&&t.status<300?"success":"danger";w(a)}}h()});const c=(0,a.ref)(false);$(document).on("mousemove",e=>{if(c.value&&e.buttons===1){const t=$(window).height();let n=t-e.pageY;n=Math.max(n,200);$("#debug-toolbar-expanded-content").css("height",`${n}px`)}});$(document).on("mouseup",()=>{c.value=false});function g(){return l.filter(e=>e.main_widget)}function p(){const e={total_requests:0,total_duration:0,queries:{}};e.queries[n.initial_request.id]=n.initial_request.sql.queries;o.value.forEach(t=>{if(t.profile&&t.profile.sql!==undefined){e.queries[t.id]=t.profile.sql.queries}});$.each(e.queries,(t,n)=>{n.forEach(t=>{e.total_requests+=1;e.total_duration+=t["time"]})});return e}const f=(0,a.ref)(false);const m=(0,a.ref)(true);function b(e,t=false,n=undefined,a={}){if(n===undefined){n=$("#debug-toolbar-expanded-content")}Object.keys(a).forEach(e=>{n.data(e,a[e])});if(t){r.value=null}r.value=e;f.value=true}function h(){$.each(g(),(e,t)=>{t.refreshButton($(`#debug-toolbar .debug-toolbar-widgets li[data-glpi-debug-widget-id="${CSS.escape(t.id)}"]`))});u.value=false}(0,a.watch)(m,e=>{if(e){$("body").removeClass("debug-folded")}else{$("body").addClass("debug-folded")}});function v(e){if(e===n.initial_request.id){return n.initial_request}return o.value.find(t=>t.id===e).profile}function w(e,t=false){const n=o.value.find(t=>t.id===e);$.ajax({url:CFG_GLPI.root_doc+"/ajax/debug.php",data:{ajax_id:e}}).done(e=>{if(!e){return}n.profile=e;const a=$("#debug-toolbar-expanded-content");if(a.data("active-widget")!==undefined){b(a.data("active-widget"),true)}if(n.server_global!==undefined){n.profile.globals["server"]=n.server_global}if(n.type==="POST"){n.profile.globals["post"]=n.data}else{n.profile.globals["get"]=n.data}h();if(t){b(a.data("active-widget"),true)}})}const x={props:n,active_widget:r,active_widget_component:i,ajax_requests:o,current_request:s,current_profile:d,initial_load:u,widgets:l,is_dragging:c,getMainWidgets:g,getCombinedSQLData:p,show_content_area:f,show_toolbar:m,switchWidget:b,refreshWidgetButtons:h,getProfile:v,requestAjaxDebugData:w,computed:a.computed,ref:a.ref,watch:a.watch};Object.defineProperty(x,"__isScriptSetup",{enumerable:false,value:true});return x}}},49:(e,t,n)=>{n.r(t);var a=n(50)},50:(e,t,n)=>{n.r(t);n.d(t,{default:()=>h});var a=n(18);var r=n.n(a);var i=n(19);var o=n.n(i);var s=n(20);var d=n.n(s);var u=n(21);var l=n.n(u);var c=n(22);var g=n.n(c);var p=n(23);var f=n.n(p);var m=n(51);var b={};b.styleTagTransform=f();b.setAttributes=l();b.insert=d().bind(null,"head");b.domAPI=o();b.insertStyleElement=g();var _=r()(m["default"],b);const h=m["default"]&&m["default"].locals?m["default"].locals:undefined},51:(e,t,n)=>{n.r(t);n.d(t,{default:()=>d});var a=n(25);var r=n.n(a);var i=n(26);var o=n.n(i);var s=o()(r());s.push([e.id,`\n.resize-handle[data-v-67e46a13] {\n        cursor: row-resize;\n        height: 10px;\n        z-index: 1030\n}\n#debug-toolbar[data-v-67e46a13] {\n        z-index: 1030; /* bootstrap $zindex-fixed (if this need to upped, keep it under 1040) */\n        outline: none;\n}\n.debug-toolbar-badge button[data-v-67e46a13] {\n        box-shadow: none;\n}\n.debug-toolbar-widgets .debug-toolbar-widget {\n&.active[data-v-67e46a13], &[data-v-67e46a13]:hover, &[active="true"][data-v-67e46a13] {\n            border-top: 3px solid var(--tblr-primary) !important;\n            margin-top : -3px;\n}\nbutton[data-v-67e46a13] {\n            box-shadow: none;\n}\n}\n#debug-toolbar-expanded-content[data-v-67e46a13] {\n        height: 30vh;\n        overflow: auto;\n}\n[data-v-67e46a13] .datagrid {\n        --tblr-datagrid-padding   : 1.5rem;\n        --tblr-datagrid-item-width: 15rem;\n\n        display                   : grid;\n        grid-gap                  : var(--tblr-datagrid-padding);\n        grid-template-columns     : repeat(auto-fit, minmax(var(--tblr-datagrid-item-width), 1fr));\n}\n[data-v-67e46a13] .datagrid-title {\n        font-size     : .625rem;\n        font-weight   : 600;\n        text-transform: uppercase;\n        letter-spacing: .04em;\n        line-height   : 1rem;\n        color         : var(--tblr-muted);\n        margin-bottom : .25rem;\n}\n`,"",{version:3,sources:["webpack://./js/src/vue/Debug/Toolbar.vue"],names:[],mappings:";AA4XI;QACI,kBAAkB;QAClB,YAAY;QACZ;AACJ;AACA;QACI,aAAa,EAAE,wEAAwE;QACvF,aAAa;AACjB;AACA;QACI,gBAAgB;AACpB;AACA;AACI;YACI,oDAAoD;YACpD,iBAAiB;AACrB;AAEA;YACI,gBAAgB;AACpB;AACJ;AACA;QACI,YAAY;QACZ,cAAc;AAClB;AACA;QACI,kCAAkC;QAClC,iCAAiC;;QAEjC,gCAAgC;QAChC,wDAAwD;QACxD,0FAA0F;AAC9F;AACA;QACI,uBAAuB;QACvB,mBAAmB;QACnB,yBAAyB;QACzB,qBAAqB;QACrB,oBAAoB;QACpB,iCAAiC;QACjC,sBAAsB;AAC1B",sourcesContent:["<script setup>\n    /**\n     * @typedef {{ id: string, parent_id: string|null, category: string, name: string, start: number, end: number }} ProfilerSection\n     * @typedef {{ execution_time: number, memory_usage: number, memory_peak: number, memory_limit: number }} ServerPerformanceMetrics\n     * @typedef {{ total_requests: number, total_duration: number, queries: { request_id: string, num: number, query: string, time: number, rows: number, warnings: string[], errors: string[] } }} SQLMetrics\n     * @typedef {{ id: string, parent_id: string, server_performance: ServerPerformanceMetrics, sql: SQLMetrics, globals: Object.<string, string>, [profiler]: ProfilerSection[] }} Profile\n     * @typedef {{ id: string, data: Object.<string, string>, url: string, server_global: Object.<string, string>, type: string, start: Date, time: number, status: number, status_type: string, profile: Profile|null }} AJAXRequestData\n     * @typedef {{ x: number, y: number, width: number, height: number }} ClientTimingBounds\n     * @typedef {{ queued: Array, redirect: Array, fetch: Array, dns: Array, connection: Array, initial_connection: Array, ssl: Array, request: Array, response: Array }} ClientTimingSections\n     * @typedef {{ type: string, name: string, start: number, end: number, bounds: Object.<string, ClientTimingBounds>, sections: ClientTimingSections }} ClientTimingData\n     * @typedef {{ id: string, show: function(content_area: jQuery, refresh: boolean) }} Widget\n     */\n    /**\n     * @typedef MainWidget\n     * @extends Widget\n     * @property {boolean} main_widget=true\n     * @property {string} title\n     * @property {string|null} icon\n     * @property {function(button: jQuery)} refreshButton\n     */\n    /**\n     * @typedef SubWidget\n     * @extends Widget\n     * @property {boolean} main_widget=false\n     */\n    import {computed, ref, watch} from \"vue\";\n\n    const props = defineProps({\n        initial_request: {\n            type: Object,\n            default: null,\n        },\n    });\n\n    const active_widget = ref(null);\n    const active_widget_component = computed(() => {\n        if (active_widget.value === null) {\n            return null;\n        }\n        const widget = widgets.find(w => w.id === active_widget.value);\n        if (widget === undefined) {\n            return null;\n        }\n        return widget.component_registered_name;\n    });\n\n    const ajax_requests = ref([]);\n\n    const current_request = ref(props.initial_request.id);\n    const current_profile = computed(() => {\n        if (current_request.value === null) {\n            return undefined;\n        }\n        return getProfile(current_request.value);\n    });\n\n    const initial_load = ref(true);\n    /**\n     * @type {(MainWidget|SubWidget)[]}\n     */\n    const widgets = [\n        {\n            id: 'server_performance',\n            title: 'Server performance',\n            icon: 'ti ti-clock-play',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-server-performance',\n            refreshButton: (button) => {\n                const server_perf = props.initial_request.server_performance;\n                const memory_usage = +(server_perf.memory_usage / 1024 / 1024).toFixed(2);\n                const server_performance_button_label = `${_.escape(server_perf.execution_time)} <span class=\"text-muted\"> ms using </span> ${_.escape(memory_usage)} <span class=\"text-muted\"> MiB </span>`;\n                button.find('.debug-text').html(server_performance_button_label);\n            }\n        },\n        {\n            id: 'sql',\n            title: 'SQL Requests',\n            icon: 'ti ti-database',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-sqlrequests',\n            refreshButton: (button) => {\n                const sql_data = getCombinedSQLData();\n                const database_button_label = `${_.escape(sql_data.total_requests)} <span class=\"text-muted\"> requests </span>`;\n                button.find('.debug-text').html(database_button_label);\n            }\n        },\n        {\n            id: 'requests',\n            title: 'HTTP Requests',\n            icon: 'ti ti-refresh',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-httprequests',\n            refreshButton: (button) => {\n                button.find('.debug-text').html(`${ajax_requests.value.length + 1} <span class=\"text-muted\"> requests </span>`);\n            }\n        },\n        {\n            id: 'client_performance',\n            title: 'Client performance',\n            icon: 'ti ti-brand-javascript',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-client-performance',\n            refreshButton: (button) => {\n                if (button.find('.debug-text').text().trim() === '') {\n                    setTimeout(() => {\n                        const dom_timing = +window.performance.getEntriesByType('navigation')[0].domComplete.toFixed(2);\n                        const client_performance_button_label = `${_.escape(dom_timing)} <span class=\"text-muted\"> ms </span>`;\n                        button.find('.debug-text').html(client_performance_button_label);\n                    }, 200);\n                }\n            }\n        },\n        {\n            id: 'search_options',\n            title: 'Search Options',\n            icon: 'ti ti-list-search',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-search-options',\n            refreshButton: (button) => {}\n        },\n        {\n            id: 'theme_switcher',\n            title: 'Palette Switcher',\n            icon: 'ti ti-palette',\n            main_widget: true, // This widget shows directly in the toolbar\n            component_registered_name: 'widget-theme-switcher',\n            refreshButton: (button) => {\n                button.find('.debug-text').html(`<span class=\"text-muted\">Theme: </span> ${_.escape(document.documentElement.attributes['data-glpi-theme'].value)}`);\n            }\n        },\n        {\n            id: 'globals',\n            main_widget: false,\n            component_registered_name: 'widget-globals',\n        },\n        {\n            id: 'profiler',\n            main_widget: false,\n            component_registered_name: 'widget-profiler',\n        },\n        {\n            id: 'request_summary',\n            main_widget: false,\n            component_registered_name: 'widget-request-summary',\n        }\n    ];\n\n    $(document).ajaxSend((event, xhr, settings) => {\n        // If the request is going to the debug AJAX endpoint, don't do anything\n        if (settings.url.indexOf('ajax/debug.php') !== -1) {\n            return;\n        }\n        const ajax_id = Math.random().toString(16).slice(2);\n        // Tag the request with an id to identify it on the server side\n        xhr.setRequestHeader('X-Glpi-Ajax-ID', ajax_id);\n        // Need to set the header here too so it is accessible in the ajaxComplete event\n        xhr.headers = xhr.headers || {};\n        xhr.headers['X-Glpi-Ajax-ID'] = ajax_id;\n        const parent_id = $('html').attr('data-glpi-request-id');\n        if (parent_id !== undefined) {\n            xhr.setRequestHeader('X-Glpi-Ajax-Parent-ID', parent_id);\n        }\n\n        let data = settings.data;\n        if (settings.type !== 'POST' && data === undefined) {\n            // get data from query string\n            data = {};\n            const query_string = settings.url.split('?')[1];\n            if (query_string !== undefined) {\n                query_string.split('&').forEach((pair) => {\n                    const [key, value] = pair.split('=');\n                    data[key] = value;\n                });\n            }\n        } else if (typeof data === 'string') {\n            // Post data is a URI encoded string similar to a query string. Values may be JSON strings\n            // so we need to parse it and convert it back to an object\n            const data_object = {};\n            data.split('&').forEach((pair) => {\n                const [key, value] = pair.split('=');\n                data_object[key] = decodeURIComponent(value);\n                // try parsing the value as JSON\n                try {\n                    data_object[key] = JSON.parse(data_object[key]);\n                } catch (e) {\n                    // ignore\n                }\n            });\n            data = data_object;\n        }\n        ajax_requests.value.push({\n            'id': ajax_id,\n            'status': '...',\n            'status_type': 'info',\n            'type': settings.type,\n            'data': data,\n            'url': settings.url,\n            'start': event.timeStamp,\n        });\n        refreshWidgetButtons();\n    });\n\n    $(document).ajaxComplete((event, xhr, settings) => {\n        // If the request is going to the debug AJAX endpoint, don't do anything\n        if (settings.url.indexOf('ajax/debug.php') !== -1) {\n            return;\n        }\n        if (xhr.headers === undefined) {\n            return;\n        }\n        const ajax_id = xhr.headers['X-Glpi-Ajax-ID'];\n        if (ajax_id !== undefined) {\n            const ajax_request = ajax_requests.value.find((request) => request.id === ajax_id);\n            if (ajax_request !== undefined) {\n                ajax_request.status = xhr.status;\n                ajax_request.time = new Date() - ajax_request.start;\n                ajax_request.status_type = xhr.status >= 200 && xhr.status < 300 ? 'success' : 'danger';\n\n                // Ask the server for the debug information it saved for this request\n                requestAjaxDebugData(ajax_id);\n            }\n        }\n        refreshWidgetButtons();\n    });\n\n    const is_dragging = ref(false);\n    $(document).on('mousemove', (e) => {\n        if (is_dragging.value && e.buttons === 1) {\n            const page_height = $(window).height();\n            let new_height = page_height - e.pageY;\n            new_height = Math.max(new_height, 200);\n            $('#debug-toolbar-expanded-content').css('height', `${new_height}px`);\n        }\n    });\n    $(document).on('mouseup', () => {\n        is_dragging.value = false;\n    });\n\n    function getMainWidgets() {\n        return widgets.filter((widget) => widget.main_widget);\n    }\n\n    function getCombinedSQLData() {\n        const sql_data = {\n            total_requests: 0,\n            total_duration: 0,\n            queries: {}\n        };\n        sql_data.queries[props.initial_request.id] = props.initial_request.sql.queries;\n        ajax_requests.value.forEach((request) => {\n            if (request.profile && request.profile.sql !== undefined) {\n                sql_data.queries[request.id] = request.profile.sql.queries;\n            }\n        });\n        $.each(sql_data.queries, (request_id, data) => {\n            // update the total counters\n            data.forEach((query) => {\n                sql_data.total_requests += 1;\n                sql_data.total_duration += query['time'];\n            });\n        });\n\n        return sql_data;\n    }\n\n    const show_content_area = ref(false);\n    const show_toolbar = ref(true);\n\n    function switchWidget(widget_id, refresh = false, content_area = undefined, data = {}) {\n        if (content_area === undefined) {\n            content_area = $('#debug-toolbar-expanded-content');\n        }\n        // Copy data into data properties of the content_area\n        Object.keys(data).forEach((key) => {\n            content_area.data(key, data[key]);\n        });\n        if (refresh) {\n            active_widget.value = null;\n        }\n        active_widget.value = widget_id;\n        show_content_area.value = true;\n    }\n\n    function refreshWidgetButtons() {\n        $.each(getMainWidgets(), (i, /** @type MainWidget */ widget) => {\n            widget.refreshButton($(`#debug-toolbar .debug-toolbar-widgets li[data-glpi-debug-widget-id=\"${CSS.escape(widget.id)}\"]`));\n        });\n        initial_load.value = false;\n    }\n\n    watch(show_toolbar, (new_value) => {\n        if (new_value) {\n            $('body').removeClass('debug-folded');\n        } else {\n            $('body').addClass('debug-folded');\n        }\n    });\n\n    function getProfile(request_id) {\n        if (request_id === props.initial_request.id) {\n            return props.initial_request;\n        }\n        return ajax_requests.value.find((request) => request.id === request_id).profile;\n    }\n\n    function requestAjaxDebugData(ajax_id, reload_widget = false) {\n        const ajax_request = ajax_requests.value.find((request) => request.id === ajax_id);\n        $.ajax({\n            url: CFG_GLPI.root_doc + '/ajax/debug.php',\n            data: {\n                'ajax_id': ajax_id,\n            }\n        }).done((data) => {\n            if (!data) {\n                return;\n            }\n            ajax_request.profile = data;\n\n            const content_area = $('#debug-toolbar-expanded-content');\n            if (content_area.data('active-widget') !== undefined) {\n                switchWidget(content_area.data('active-widget'), true);\n            }\n            // Move server global to the profile\n            if (ajax_request.server_global !== undefined) {\n                ajax_request.profile.globals['server'] = ajax_request.server_global;\n            }\n            // Move the data to either the get or post global depending on the request type\n            if (ajax_request.type === 'POST') {\n                ajax_request.profile.globals['post'] = ajax_request.data;\n            } else {\n                ajax_request.profile.globals['get'] = ajax_request.data;\n            }\n            refreshWidgetButtons();\n\n            if (reload_widget) {\n                // reload active widget\n                switchWidget(content_area.data('active-widget'), true);\n            }\n        });\n    }\n<\/script>\n\n<template>\n    <div id=\"debug-toolbar\" :class=\"'position-fixed bottom-0 card ' + (show_toolbar ? 'w-100' : '')\" tabindex=\"0\" :style=\"show_toolbar ? '' : 'width: fit-content'\">\n        <div class=\"resize-handle mt-n2\" @mousedown.prevent=\"$event.buttons === 1 && (is_dragging = true)\"></div>\n        <div class=\"d-flex flex-row align-items-center\">\n            <div class=\"debug-toolbar-badge d-flex\">\n                <button type=\"button\" class=\"btn btn-icon border-0 px-3 opacity-100 debug-logo\" @click=\"show_toolbar = true\" :disabled=\"show_toolbar\"\n                        title=\"Toggle debug bar\">\n                    <i class=\"ti ti-bug\"></i>\n                </button>\n            </div>\n            <div :class=\"'debug-toolbar-content w-100 justify-content-between align-items-center ' + (show_toolbar ? 'd-flex' : '')\" v-show=\"show_toolbar\">\n                <ul class=\"debug-toolbar-widgets nav nav-tabs align-items-center border-0\" data-bs-toggle=\"tabs\">\n                    <widget-button v-for=\"(widget) in getMainWidgets()\" :id=\"widget.id\" :title=\"widget.title\" :icon=\"widget.icon\"\n                                   v-on:click=\"switchWidget(widget.id)\" :active=\"widget.id === active_widget\" @vue:mounted=\"refreshWidgetButtons\"\n                    ></widget-button>\n                </ul>\n                <div class=\"debug-toolbar-controls\">\n                    <div class=\"debug-toolbar-control\">\n                        <button type=\"button\" class=\"btn btn-icon border-0 p-1\" name=\"toggle_content_area\" @click=\"show_content_area = !show_content_area\"\n                                title=\"Toggle debug content area\">\n                            <i :class=\"show_content_area ? 'ti ti-square-arrow-up' : 'ti ti-square-arrow-down'\"></i>\n                        </button>\n                        <button type=\"button\" class=\"btn btn-icon border-0 p-1\" title=\"Close\" @click=\"show_toolbar = false\">\n                            <i class=\"ti ti-square-x\"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div id=\"debug-toolbar-expanded-content\" class=\"w-100 card pe-2\" v-show=\"show_content_area && show_toolbar\">\n            <component v-if=\"active_widget\" :is=\"active_widget_component\" :initial_request=\"props.initial_request\"\n               :ajax_requests=\"ajax_requests\" @switchWidget=\"switchWidget\" :widgets=\"widgets\"\n               @refreshButton=\"refreshWidgetButtons\"></component>\n        </div>\n    </div>\n</template>\n\n<style scoped>\n    .resize-handle {\n        cursor: row-resize;\n        height: 10px;\n        z-index: 1030\n    }\n    #debug-toolbar {\n        z-index: 1030; /* bootstrap $zindex-fixed (if this need to upped, keep it under 1040) */\n        outline: none;\n    }\n    .debug-toolbar-badge button {\n        box-shadow: none;\n    }\n    .debug-toolbar-widgets .debug-toolbar-widget {\n        &.active, &:hover, &[active=\"true\"] {\n            border-top: 3px solid var(--tblr-primary) !important;\n            margin-top : -3px;\n        }\n\n        button {\n            box-shadow: none;\n        }\n    }\n    #debug-toolbar-expanded-content {\n        height: 30vh;\n        overflow: auto;\n    }\n    :deep(.datagrid) {\n        --tblr-datagrid-padding   : 1.5rem;\n        --tblr-datagrid-item-width: 15rem;\n\n        display                   : grid;\n        grid-gap                  : var(--tblr-datagrid-padding);\n        grid-template-columns     : repeat(auto-fit, minmax(var(--tblr-datagrid-item-width), 1fr));\n    }\n    :deep(.datagrid-title) {\n        font-size     : .625rem;\n        font-weight   : 600;\n        text-transform: uppercase;\n        letter-spacing: .04em;\n        line-height   : 1rem;\n        color         : var(--tblr-muted);\n        margin-bottom : .25rem;\n    }\n</style>\n"],sourceRoot:""}]);const d=s}}]);