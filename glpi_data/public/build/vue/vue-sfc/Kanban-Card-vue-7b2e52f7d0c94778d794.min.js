/*!
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
"use strict";(self["webpackChunk_glpi_glpi"]=self["webpackChunk_glpi_glpi"]||[]).push([[18],{27:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t["default"]=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t){a[e]=n}return a}},137:(e,t,a)=>{a.r(t);a.d(t,{default:()=>o});var n=a(138);var r=a(140);var s=a(27);const i=(0,s["default"])(r["default"],[["render",n.render],["__file","js/src/vue/Kanban/Card.vue"]]);if(false){}const o=i},138:(e,t,a)=>{a.r(t);a.d(t,{render:()=>n.render});var n=a(139)},139:(e,t,a)=>{a.r(t);a.d(t,{render:()=>w});var n=a(9);const r=["id"];const s={class:"kanban-item-header d-flex justify-content-between"};const i={class:"kanban-item-title d-flex align-items-center"};const o=["textContent"];const d={class:"dropdown"};const l={type:"button",class:"kanban-item-overflow-actions cursor-pointer pt-0 b-0","data-bs-toggle":"dropdown","data-bs-auto-close":"outside"};const c={class:"ti ti-dots",ref:"btn_overflow"};const m={ref:"card_overflow_dropdown",class:"kanban-dropdown dropdown-menu",role:"menu"};const u={key:0,class:"kanban-item-goto dropdown-item"};const _=["href"];const g=["textContent"];const p=["innerHTML"];const h={class:"d-flex justify-content-between"};const f={class:"kanban-item-team position-relative"};const b=["innerHTML"];const k=["innerHTML"];const v={class:"align-self-center kanban-item-due-date"};const y=["title"];const B=["textContent"];function w(e,t,a,w,C,E){return(0,n.openBlock)(),(0,n.createElementBlock)("li",{id:a.id,class:(0,n.normalizeClass)(`kanban-item card shadow-none ${a.read_only?"readonly":""} ${w.is_deleted?"deleted":""}`)},[(0,n.createElementVNode)("div",s,[(0,n.createElementVNode)("span",i,[(0,n.createElementVNode)("i",{class:(0,n.normalizeClass)(a.icon)},null,2),(0,n.createElementVNode)("span",{class:"cursor-pointer",textContent:(0,n.toDisplayString)(a.title),onClick:t[0]||(t[0]=e=>w.emit("kanban:card_show_details"))},null,8,o)]),(0,n.createElementVNode)("div",d,[(0,n.createElementVNode)("button",l,[(0,n.createElementVNode)("i",c,null,512)]),(0,n.createElementVNode)("ul",m,[a.form_link?((0,n.openBlock)(),(0,n.createElementBlock)("li",u,[(0,n.createElementVNode)("a",{href:a.form_link,class:"w-100"},[t[3]||(t[3]=(0,n.createElementVNode)("i",{class:"ti ti-share-3"},null,-1)),(0,n.createTextVNode)((0,n.toDisplayString)(e.__("Go to")),1)],8,_)])):(0,n.createCommentVNode)("v-if",true),a.rights.canDeleteItem()&&w.is_deleted?((0,n.openBlock)(),(0,n.createElementBlock)("li",{key:1,class:"kanban-item-restore dropdown-item cursor-pointer",onClick:t[1]||(t[1]=e=>w.emit("kanban:card_restore"))},[(0,n.createElementVNode)("span",null,[t[4]||(t[4]=(0,n.createElementVNode)("i",{class:"ti ti-trash-off"},null,-1)),(0,n.createTextVNode)((0,n.toDisplayString)(e.__("Restore")),1)])])):(0,n.createCommentVNode)("v-if",true),a.rights.canDeleteItem()?((0,n.openBlock)(),(0,n.createElementBlock)("li",{key:2,class:"kanban-item-remove dropdown-item cursor-pointer",onClick:t[2]||(t[2]=e=>w.emit("kanban:card_delete"))},[(0,n.createElementVNode)("span",null,[t[5]||(t[5]=(0,n.createElementVNode)("i",{class:"ti ti-trash"},null,-1)),(0,n.createTextVNode)((0,n.toDisplayString)(w.is_deleted?e.__("Purge"):e.__("Delete")),1)])])):(0,n.createCommentVNode)("v-if",true)],512)])]),a.metadata.content?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:0,class:"kanban-description-preview",textContent:(0,n.toDisplayString)(a.metadata.content)},null,8,g)):(0,n.createCommentVNode)("v-if",true),(0,n.createElementVNode)("div",{class:"kanban-item-content",innerHTML:a.card_content},null,8,p),(0,n.createElementVNode)("div",h,[(0,n.createElementVNode)("div",f,[((0,n.openBlock)(true),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(w.badges_to_show,e=>((0,n.openBlock)(),(0,n.createElementBlock)("span",{key:e.hash,innerHTML:e.content},null,8,b))),128)),Object.values(a.team).length>a.team_badge_provider.max_team_images?((0,n.openBlock)(),(0,n.createElementBlock)("span",{key:0,innerHTML:a.team_badge_provider.generateOverflowBadge(Object.values(a.team).length-a.team_badge_provider.max_team_images)},null,8,k)):(0,n.createCommentVNode)("v-if",true)]),(0,n.createElementVNode)("div",v,[a.due_date?((0,n.openBlock)(),(0,n.createElementBlock)("span",{key:0,title:e.__("Planned end date")},[t[6]||(t[6]=(0,n.createElementVNode)("i",{class:"ti ti-calendar"},null,-1)),(0,n.createElementVNode)("span",{textContent:(0,n.toDisplayString)(a.due_date)},null,8,B)],8,y)):(0,n.createCommentVNode)("v-if",true)])])],10,r)}},140:(e,t,a)=>{a.r(t);a.d(t,{default:()=>n["default"]});var n=a(141)},141:(e,t,a)=>{a.r(t);a.d(t,{default:()=>i});var n=a(9);var r=a(142);var s=a(143);const i={__name:"Card",props:{id:{type:String,required:true},read_only:{type:Boolean,required:false,default:false},title:{type:String,required:true},title_tooltip:{type:String,required:false,default:undefined},icon:{type:String,required:false,default:""},card_content:{type:String,required:false,default:""},team:{type:Object,required:false,default:()=>{}},metadata:{type:Object,required:false,default:()=>{}},form_link:{type:String,required:false,default:undefined},rights:{type:r.Rights,required:true},team_badge_provider:{type:s.TeamBadgeProvider,required:true},due_date:{type:String,required:false,default:undefined}},emits:["kanban:card_delete","kanban:card_restore","kanban:card_show_details"],setup(e,{expose:t,emit:a}){t();const i=e;const o=a;const d=(0,n.computed)(()=>!!(i.metadata.is_deleted||0));const l=(0,n.ref)(null);const c=(0,n.ref)(null);const m=(0,n.ref)(true);const u=(0,n.computed)(()=>{if(!m.value){return[]}const e=Object.values(i.team).slice(0,i.team_badge_provider.max_team_images);$.each(e,(e,t)=>{t.content=i.team_badge_provider.getTeamBadge(t);t.hash=i.team_badge_provider.getTeamBadgeHash(t)});return e});$(i.team_badge_provider.event_target).on("kanban:team_badge:changed",()=>{m.value=false;(0,n.nextTick)(()=>{m.value=true})});const _={props:i,emit:o,is_deleted:d,card_overflow_dropdown:l,btn_overflow:c,render_badges:m,badges_to_show:u,computed:n.computed,nextTick:n.nextTick,ref:n.ref,get Rights(){return r.Rights},get TeamBadgeProvider(){return s.TeamBadgeProvider}};Object.defineProperty(_,"__isScriptSetup",{enumerable:false,value:true});return _}}},142:(e,t,a)=>{a.r(t);a.d(t,{Rights:()=>n});
/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @copyright 2003-2014 by the INDEPNET Development Team.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */class n{constructor(e){this.create_item=e["create_item"]||false;this.delete_item=e["delete_item"]||false;this.create_column=e["create_column"]||false;this.modify_view=e["modify_view"]||false;this.create_card_limited_columns=e["create_card_limited_columns"]||[];this.order_card=e["order_card"]||false}canCreateItem(){return this.create_item}canDeleteItem(){return this.delete_item}canCreateColumn(){return this.create_column}canModifyView(){return this.modify_view}canOrderCard(){return this.order_card}getAllowedColumnsForNewCards(){return this.create_card_limited_columns}}},143:(e,t,a)=>{a.r(t);a.d(t,{TeamBadgeProvider:()=>n});
/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @copyright 2003-2014 by the INDEPNET Development Team.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */class n{constructor(e,t=3){this.badges={User:{},Group:{},Supplier:{},Contact:{}};this.user_pictures_to_load=new Set([]);this.dark_theme=$("html").attr("data-glpi-theme-dark")==="1";this.team_image_size=26;this.max_team_images=t;this.display_initials=e;this.event_target=new EventTarget}getTeamBadgeHash(e){const t=e["itemtype"];const a=e["id"];const n=this.getTeamBadge(e);return btoa(encodeURI(t+a+n)).slice(0,8)}getTeamBadge(e){const t=e["itemtype"];const a=e["id"];if(this.badges[t]!==undefined&&this.badges[t][a]!==undefined){return this.badges[t][a]}if(t==="User"){this.user_pictures_to_load.add(a);this.badges[t][a]=this.generateUserBadge(e);return this.badges[t][a]}switch(t){case"Group":this.badges[t][a]=this.generateOtherBadge(e,"ti ti-users-group");break;case"Supplier":this.badges[t][a]=this.generateOtherBadge(e,"ti ti-truck-loading");break;case"Contact":this.badges[t][a]=this.generateOtherBadge(e,"ti ti-user");break;default:this.badges[t][a]=this.generateOtherBadge(e,"ti ti-user")}return this.badges[t][a]}fetchRequiredUserPictures(){const e=Array.from(this.user_pictures_to_load.values());if(e.length===0){return}this.user_pictures_to_load.clear();$.ajax({type:"POST",url:`${CFG_GLPI["root_doc"]}/ajax/getUserPicture.php`,data:{users_id:e,size:this.team_image_size}}).done(t=>{const a=[];Object.keys(e).forEach(e=>{if(t[e]!==undefined){this.badges["User"][e]=`<span>${_.escape(t[e])}</span>`;a.push(e)}});this.event_target.dispatchEvent(new CustomEvent("kanban:team_badge:changed",{detail:{User:a}}))})}getBadgeColor(e){let t=JSON.parse(window.sessionStorage.getItem("badge_colors"));const a=e["itemtype"];const n=Math.random();const r=Math.random()*10+(this.dark_theme?25:70);let s=tinycolor(`hsl(${n*360}, 100%, ${r}%)`).toHexString();if(t!==null&&t[a]!==null&&t[a][e["id"]]){s=t[a][e["id"]]}else{if(t===null){t={User:{},Group:{},Supplier:{},Contact:{},_dark_theme:this.dark_theme}}t[a][e["id"]]=s;window.sessionStorage.setItem("badge_colors",JSON.stringify(t))}return s}getBadgeCanvas(e){const t=document.createElement("canvas");t.width=this.team_image_size;t.height=this.team_image_size;const a=t.getContext("2d");a.strokeStyle="#f1f1f1";a.fillStyle=e;a.beginPath();a.arc(this.team_image_size/2,this.team_image_size/2,this.team_image_size/2,0,2*Math.PI);a.fill();a.fillStyle=this.dark_theme?"white":"black";a.textAlign="center";a.font=`bold ${this.team_image_size/2}px sans-serif`;a.textBaseline="middle";return t}generateUserBadge(e){let t="";if(e["firstname"]){t+=e["firstname"][0]}if(e["realname"]){t+=e["realname"][0]}t=t.toUpperCase();if(!this.display_initials||t.length===0){return this.generateOtherBadge(e,"ti ti-user")}const a=this.getBadgeCanvas(this.getBadgeColor(e));const n=a.getContext("2d");n.fillText(t,this.team_image_size/2,this.team_image_size/2);const r=a.toDataURL("image/png");const s=e["name"];return`<span><img src="${_.escape(r)}" title="${_.escape(s)}" data-bs-toggle="tooltip" data-bs-placement="top" data-placeholder-users-id="${_.escape(e["id"])}"/></span>`}generateOtherBadge(e,t){const a=this.getBadgeColor(e);const n=e["name"];return`\n            <span class="badge badge-pill" style="background-color: ${_.escape(a)}; font-size: ${this.team_image_size/2}px; height: 26px; padding: 0.25em;">\n                <i class="${_.escape(t)}" title="${_.escape(n)}" data-bs-toggle="tooltip" data-bs-placement="top"></i>\n            </span>\n        `}generateOverflowBadge(e){const t=this.dark_theme?40:80;const a=this.getBadgeCanvas(`hsl(255, 0%, ${t}%, 1)`);const n=a.getContext("2d");n.fillText(`+${e}`,this.team_image_size/2,this.team_image_size/2);const r=a.toDataURL("image/png");return`<span class="position-relative"><img src="${_.escape(r)}" title="${__("%d other team members").replace("%d",e)}" data-bs-toggle="tooltip" data-bs-placement="top"></span>`}}}}]);