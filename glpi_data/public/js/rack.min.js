/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @copyright 2003-2014 by the INDEPNET Development Team.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
let pos_before_drag={x:0,y:0};var dirty=false;var initRack=function(){const e=e=>({x:Number(e.attr("gs-x"))||0,y:Number(e.attr("gs-y"))||0});$(document).on("click","#sviewlist",function(){$("#viewlist").show();$("#viewgraph").hide();$(this).addClass("selected");$("#sviewgraph").removeClass("selected")}).on("click","#sviewgraph",function(){$("#viewlist").hide();$("#viewgraph").show();$(this).addClass("selected");$("#sviewlist").removeClass("selected")}).on("click","#toggle_images",function(){$("#toggle_text").toggle();$(this).toggleClass("active");$("#viewgraph").toggleClass("clear_picture")}).on("click","#toggle_text",function(){$(this).toggleClass("active");$("#viewgraph").toggleClass("clear_text")}).on("click",".cell_add",function(){var e=grid_rack_units-$(this).index();var t=$(this).parents(".rack_side").hasClass("rack_front")?0:1;glpi_ajax_dialog({url:grid_link_url,method:"get",dialogclass:"modal-xl",params:{racks_id:grid_rack_id,orientation:t,position:e,ajax:true}})}).on("click","a.edit_rack_item",e=>{e.preventDefault();const t=$(e.currentTarget).attr("href");glpi_ajax_dialog({url:t,method:"get",dialogclass:"modal-xl",params:{ajax:true}})}).on("click","#add_pdu",e=>{e.preventDefault();glpi_ajax_dialog({title:__("Add PDU"),url:grid_item_ajax_url,method:"get",dialogclass:"modal-xl",params:{racks_id:grid_rack_id,action:"show_pdu_form",ajax:true}})});const t=GridStack.initAll({cellHeight:21,margin:0,marginBottom:1,float:true,disableOneColumnMode:true,animate:true,removeTimeout:100,disableResize:true});t.forEach(t=>{var a=$(t.el).hasClass("side_pdus_graph");t.on("dragstart",t=>{var a=$(t.target);pos_before_drag=e(a);a.qtip("hide",true)}).on("change",(i,r)=>{if(dirty){return}var s=$(t.el).parents(".racks_col").hasClass("rack_rear");$.each(r,(i,r)=>{var l=$(r.el);var d=l.hasClass("half_rack");var o=grid_rack_units-e(l).y-(l.attr("gs-h")??1)+1;$.post(grid_item_ajax_url,{id:r.id,action:a?"move_pdu":"move_item",position:o,hpos:getHpos(e(l).x,d,s)},a=>{if(!a.status){dirty=true;t.update(r.el,pos_before_drag);dirty=false;displayAjaxMessageAfterRedirect()}else{var i=l.hasClass("item_rear")?"item_front":"item_rear";var s=$(`.grid-stack-item.${CSS.escape(i)}[gs-id=${CSS.escape(l.attr("gs-id"))}]`);if(s.length){var d=GridStack.init({},$(s).closest(".grid-stack")[0]);const t=e(l);if(l.attr("gs-w")==1){t.x=t.x===0?1:0}dirty=true;d.update(s[0],t);dirty=false}}}).fail(()=>{dirty=true;t.update(r.el,pos_before_drag);dirty=false;displayAjaxMessageAfterRedirect()})})}).on("dragstart",t=>{var a=$(t.target);pos_before_drag=e(a);a.qtip("hide",true)})});$("#viewgraph .cell_add, #viewgraph .grid-stack-item").each(function(){var e=$(this).find(".tipcontent");if(e.length){$(this).qtip({position:{my:"left center",at:"right center"},content:{text:e},style:{classes:"qtip-shadow qtip-bootstrap rack_tipcontent"}})}});for(var a=grid_rack_units;a>=1;a--){$(".indexes").append(`<li>${a}</li>`);$(".racks_add").append(`<div class="cell_add"><span class="tipcontent">${_.escape(grid_rack_add_tip)}</span></div>`)}};var getHpos=function(e,t,a){if(!t){return 0}else if(e==0&&!a){return 1}else if(e==0&&a){return 2}else if(e==1&&a){return 1}else if(e==1&&!a){return 2}};