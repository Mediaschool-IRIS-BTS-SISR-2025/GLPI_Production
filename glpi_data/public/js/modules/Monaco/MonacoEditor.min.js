/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @copyright 2003-2014 by the INDEPNET Development Team.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
window.GLPI=window.GLPI||{};export default class MonacoEditor{constructor(e,n,o="",t=[],i={}){const r=document.getElementById(e);const s={twig:["{"," "]};const a=window.monaco.languages.getLanguages().find(e=>e.id===n);const l=i["_force_default_lang"]?n:`glpi_${n}_${Math.random().toString(36).substring(2,15)}`;async function d(){if(!a||typeof a.loader!=="function"){return}const e=await a.loader();window.monaco.languages.setMonarchTokensProvider(l,e.language);window.monaco.languages.setLanguageConfiguration(l,e.conf)}if(!i["_force_default_lang"]){window.monaco.languages.register({id:l,extensions:a.extensions,aliases:a.aliases,mimetypes:a.mimetypes});d()}window.monaco.languages.registerCompletionItemProvider(l,{triggerCharacters:s[n]??[],provideCompletionItems:(e,o)=>{const i=e.getWordUntilPosition(o);const r={startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn};let s="";let a="";if(n==="twig"){const n=e.getValueInRange({startLineNumber:1,endLineNumber:o.lineNumber,startColumn:1,endColumn:o.column});const t=e.getValueInRange({startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:o.column,endColumn:o.column+1});const i=n.match(/{{\s*$/g);const r=t.match(/\s*}}/g);if(i&&!r){s=" ";a=" }}"}else if(!i&&!n.match(/{\s*$/g)){s="{{ ";if(n.match(/\s{0}$/g)&&o.column>2){s=" {{ "}a=" }}"}else{return{suggestions:[]}}}return{suggestions:(e=>{const o=[];if(n==="twig"){o.push(...this.getTwigCompletions())}for(const n of t){o.push({label:{label:n.name,detail:n.detail||""},kind:window.monaco.languages.CompletionItemKind[n.type],insertText:s+n.name+a,documentation:n.name,range:e})}return o})(r)}}});const c=$("html").attr("data-glpi-theme-dark")==="1";delete i._force_default_lang;window.GLPI.Monaco.registerGLPIThemes();this.editor=window.monaco.editor.create(r,Object.assign({value:o,language:l,theme:c?"glpi-dark":"glpi"},i));if(i._single_line_editor){$(r).find(".monaco-editor").get(0).style.setProperty("--vscode-editor-background","transparent");$(r).find(".monaco-editor").get(0).style.setProperty("font","inherit");this.editor.onDidChangeCursorPosition(e=>{if(e.position.lineNumber!==1){this.editor.setValue(this.editor.getValue().trim());this.editor.setPosition({lineNumber:1,column:Infinity})}});this.editor.onDidChangeModelContent(()=>{if(this.editor.getValue().match(/\n/g)){this.editor.setValue(this.editor.getValue().replace(/\n/g,""))}})}}getTwigCompletions(){const e=["apply","autoescape","block","for","if","elseif","macro","set","endapply","endautoescape","endblock","endfor","endif","endmacro","endset","true","false","null"];const n=["in","is","and","or","not","b-and","b-xor","b-or","matches","starts with","ends with","has some","has every"];const o=["date","min","max","random","range"];const t=["abs","batch","capitalize","column","date","default","escape","filter","first","format","join","json_encode","keys","last","length","lower","map","merge","nl2br","raw","reduce","replace","reverse","round","slice","sort","split","striptags","title","trim","upper","url_encode"];function i(e){return{label:e,kind:window.monaco.languages.CompletionItemKind["Keyword"],insertText:e}}function r(e){return{label:e,kind:window.monaco.languages.CompletionItemKind["Operator"],insertText:e}}function s(e){return{label:e,kind:window.monaco.languages.CompletionItemKind["Function"],insertText:e}}const a=[];for(const n of e){a.push(i(n))}for(const e of n){a.push(r(e))}for(const e of o){a.push(s(e))}for(const e of t){a.push(s(e))}return a}}window.GLPI.Monaco={registerGLPIThemes:()=>{if(window.GLPI.Monaco._themes_registered){return}const e=[{token:"operator.sql",foreground:"#5E6F7D"},{token:"string.sql",foreground:"#d90000"}];window.monaco.editor.defineTheme("glpi",{base:"vs",inherit:true,colors:{},rules:e});window.monaco.editor.defineTheme("glpi-dark",{base:"vs-dark",inherit:true,colors:{},rules:[]});window.GLPI.Monaco._themes_registered=true},createEditor:async(e,n,o="",t=[],i={})=>import("/lib/monaco.js").then(()=>new MonacoEditor(e,n,o,t,i)),colorizeText:async(e,n)=>{const o=document.createElement("div");$(o).attr("lang",n);$(o).text(e);return window.GLPI.Monaco.colorizeElement(o,n).then(()=>o.innerHTML)},colorizeElement:async(e,n)=>import("/lib/monaco.js").then(()=>{window.GLPI.Monaco.registerGLPIThemes();return window.monaco.editor.colorizeElement(e,{language:n,theme:$("html").attr("data-glpi-theme-dark")==="1"?"glpi-dark":"glpi"})}),getSingleLineEditorOptions:()=>{const e=$(document.body).css("font-size").replace("px","");return{_single_line_editor:true,acceptSuggestionOnEnter:"on",contextmenu:false,cursorStyle:"line-thin",find:{addExtraSpaceOnTop:false,autoFindInSelection:"never",seedSearchStringFromSelection:"never"},fixedOverflowWidgets:true,folding:false,fontSize:e,fontWeight:"normal",glyphMargin:false,hideCursorInOverviewRuler:true,hover:{delay:100},lineDecorationsWidth:0,lineNumbers:"off",lineNumbersMinChars:0,links:false,minimap:{enabled:false},occurrencesHighlight:"off",overviewRulerBorder:false,overviewRulerLanes:0,quickSuggestions:false,renderLineHighlight:"none",roundedSelection:false,scrollBeyondLastColumn:0,scrollbar:{horizontal:"hidden",vertical:"hidden",alwaysConsumeMouseWheel:false},wordBasedSuggestions:"off",wordWrap:"off"}}};