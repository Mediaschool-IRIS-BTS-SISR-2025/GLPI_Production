/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2025 Teclib' and contributors.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
export class GlpiFormQuestionTypeDateTime{#e;constructor(e){this.#e=e;$(document).on("change",'input[id^="is_default_value_current_time_"]',e=>{const t=$(e.target).closest("section[data-glpi-form-editor-question]");this.updateDateAndTimeInputType(t)});$(document).on("change",'input[id^="is_date_enabled_"], input[id^="is_time_enabled_"]',e=>{const t=e.target;const i=$(t).is(":checked");const n=$(t).closest("section[data-glpi-form-editor-question]");const s=n.find('input[id^="is_date_enabled_"], input[id^="is_time_enabled_"]').not(`[name="${CSS.escape(t.name)}"]`);if(!i&&s.not(":checked").length){s.prop("checked",true)}this.updateDateAndTimeInputType(n)});window.updateDateAndTimeInputType=e=>this.updateDateAndTimeInputType(e)}#t(e,t,i){if(!e){return""}try{const n=e.includes("T")?e.split("T")[0]:!e.includes(":")?e:null;const s=e.includes("T")?e.split("T")[1]:e.includes(":")?e:null;if(t&&i){const e=n||(new Date).toISOString().split("T")[0];const t=s||(new Date).toTimeString().substr(0,5);return`${e}T${t}`}else if(i){return s||""}else if(t){return n||""}}catch(e){console.warn("Error converting datetime value",e)}return""}updateDateAndTimeInputType(e){const t=e.find('input[id^="date_input_"]');const i=e.find('input[id^="is_default_value_current_time_"]');const n=e.find('input[id^="is_date_enabled_"]').is(":checked");const s=e.find('input[id^="is_time_enabled_"]').is(":checked");const a=t.val();let d="date";let l=this.#e.input.date;let c=this.#e.default_value.date;if(n&&s){d="datetime-local";l=this.#e.input["datetime-local"];c=this.#e.default_value["datetime-local"]}else if(s){d="time";l=this.#e.input.time;c=this.#e.default_value.time}t.prop("type",d);t.prop("placeholder",l);t.prop("disabled",false);if(i.is(":checked")){t.prop("type","text");t.val("");t.prop("disabled",true)}else{const e=this.#t(a,n,s);if(e){t.val(e)}}i.siblings("span").text(c)}}